<!DOCTYPE html><html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"><title>Infrastructure as Code with Deployment Manager – Google Cloud Platform - Community – Medium</title><link rel="canonical" href="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122"><meta name="title" content="Infrastructure as Code with Deployment Manager – Google Cloud Platform - Community – Medium"><meta name="referrer" content="unsafe-url"><meta name="description" content="Infrastructure as code is the practice of making the configuration of your infrastructure reproducible, scalable, and easy to review, by describing it using code. Infrastructure as code comes from…"><meta name="theme-color" content="#000000"><meta property="og:title" content="Infrastructure as Code with Deployment Manager"><meta property="twitter:title" content="Infrastructure as Code with Deployment Manager"><meta property="og:url" content="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/1*c71MGBJTmz_XvqrY1rUbIg.png"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="Setup a Kubernetes Cluster and Kubernetes Applications in GCP using Deployment Manager"><meta name="twitter:description" content="Setup a Kubernetes Cluster and Kubernetes Applications in GCP using Deployment Manager"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/1*c71MGBJTmz_XvqrY1rUbIg.png"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@schweikert"><meta name="author" content="David Schweikert"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@schweikert"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2018-05-02T05:03:51.242Z"><meta name="twitter:creator" content="@dschweikert"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="9 min read"><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/5ebb8759a122"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/5ebb8759a122"><meta property="al:android:url" content="medium://p/5ebb8759a122"><meta property="al:web:url" content="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml" /><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/5ebb8759a122" /><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":1816,"height":760,"url":"https://cdn-images-1.medium.com/max/2600/1*c71MGBJTmz_XvqrY1rUbIg.png"},"url":"https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122","dateCreated":"2018-05-02T05:03:51.242Z","datePublished":"2018-05-02T05:03:51.242Z","dateModified":"2018-06-19T07:10:47.875Z","headline":"Infrastructure as Code with Deployment Manager","name":"Infrastructure as Code with Deployment Manager","articleId":"5ebb8759a122","thumbnailUrl":"https://cdn-images-1.medium.com/max/2600/1*c71MGBJTmz_XvqrY1rUbIg.png","keywords":["Tag:Google Cloud Platform","Tag:Kubernetes","Tag:Infrastructure As Code","Publication:google-cloud","LockedPostSource:0","Elevated:false","LayerCake:0"],"author":{"@type":"Person","name":"David Schweikert","url":"https://medium.com/@schweikert"},"creator":["David Schweikert"],"publisher":{"@type":"Organization","name":"Google Cloud Platform - Community","url":"https://medium.com/google-cloud","logo":{"@type":"ImageObject","width":60,"height":60,"url":"https://cdn-images-1.medium.com/max/120/1*FUjLiCANvATKeaJEeg20Rw.png"}},"mainEntityOfPage":"https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122"}</script><meta name="parsely-link" content="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122"><link rel="stylesheet" type="text/css" class="js-glyph-" id="glyph-8" href="https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css" /><link rel="stylesheet" href="https://cdn-static-1.medium.com/_/fp/css/main-branding-base.95h6LstxJX8UWgJm7QqR7A.css"><script>!function(n,e){var t,o,i,c=[],f={passive:!0,capture:!0},r=new Date,a="pointerup",u="pointercancel";function p(n,c){t||(t=c,o=n,i=new Date,w(e),s())}function s(){o>=0&&o<i-r&&(c.forEach(function(n){n(o,t)}),c=[])}function l(t){if(t.cancelable){var o=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;"pointerdown"==t.type?function(t,o){function i(){p(t,o),r()}function c(){r()}function r(){e(a,i,f),e(u,c,f)}n(a,i,f),n(u,c,f)}(o,t):p(o,t)}}function w(n){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(e){n(e,l,f)})}w(n),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(n){c.push(n),s()}}(addEventListener,removeEventListener);</script><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; ga("create", "UA-24232453-2", "auto", {"allowLinker": true, "legacyCookieDomain": window.location.hostname}); ga("send", "pageview");</script><script async src="https://www.google-analytics.com/analytics.js"></script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/304/304/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/240/240/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/152/152/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/120/120/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"></head><body itemscope class=" postShowScreen browser-chrome is-withMagicUnderlines v-glyph v-glyph--m2 is-noJs"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"></div><div class="metabar u-clearfix u-boxShadow4px12pxBlackLightest u-fixed u-backgroundTransparentWhiteDarkest u-xs-sizeFullViewportWidth js-metabar"><div class="branch-journeys-top"></div><div class="js-metabarMiddle metabar-inner u-marginAuto u-maxWidth1032 u-flexCenter u-justifyContentSpaceBetween u-height65 u-xs-height56 u-paddingHorizontal20"><div class="metabar-block u-flex1 u-flexCenter"><div class="u-xs-hide js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-fillTransparentBlackDarker u-flex0 u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flex0 u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45" ><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"/></svg></span><span class="u-textScreenReader">Homepage</span></a></div><div class="u-xs-show js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-fillTransparentBlackDarker u-flex0 u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flex0 u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45" ><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"/></svg></span><span class="u-textScreenReader">Homepage</span></a></div></div><div class="metabar-block u-flex0 u-flexCenter"><div class="u-flexCenter u-height65 u-xs-height56"><div class="buttonSet buttonSet--wide u-lineHeightInherit"><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-xs-hide js-signInButton"   href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2Fgoogle-cloud%2F2018-google-deployment-manager-5ebb8759a122&amp;source=--------------------------nav_reg&amp;operation=login" data-action="sign-in-prompt" data-redirect="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122" data-action-source="--------------------------nav_reg">Sign in</a><a class="button button--primary button--withChrome u-accentColor--buttonNormal is-inSiteNavBar js-signUpButton"   href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2Fgoogle-cloud%2F2018-google-deployment-manager-5ebb8759a122&amp;source=--------------------------nav_reg&amp;operation=register" data-action="sign-up-prompt" data-redirect="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122" data-action-source="--------------------------nav_reg">Get started</a></div></div></div></div><div class="u-borderTopLighter " ><div class="metabar-inner u-marginAuto u-maxWidth1032 u-paddingHorizontal20 js-metabarBottom"><nav role="navigation" class="metabar-block metabar-block--below u-flexCenter u-overflowHidden u-height54"><div class="u-flexCenter u-overflowHidden"><div class="u-marginRight40"><a href="https://medium.com/google-cloud?source=logo-lo_cb6313db35f1---e52cf94d98af" class="u-flexCenter js-collectionLogoOrName"><img height="36" width="36" src="https://cdn-images-1.medium.com/letterbox/72/72/50/50/1*FUjLiCANvATKeaJEeg20Rw.png?source=logoAvatar-lo_cb6313db35f1---e52cf94d98af" alt="Google Cloud Platform - Community" /></a></div><div class="u-overflowHidden u-xs-hide"><ul class="u-textAlignLeft u-noWrap u-overflowX u-height80 u-marginTop40 js-collectionNavItems"><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/weekly/home">This Week in GCP</a></li><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/tagged/kubernetes">Containers</a></li><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/tagged/google-compute-engine">Virtualization</a></li><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/tagged/google-app-engine">Platform as a Service</a></li><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/tagged/bigquery">Data</a></li><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/tagged/machine-learning">Machine Learning</a></li><li class="metabar-navItem js-collectionNavItem u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://medium.com/google-cloud/tagged/iot">IoT</a></li><span class="u-borderLeft1 u-baseColor--borderLight"></span><li class="metabar-navItem js-collectionNavItem is-external u-inlineBlock u-fontSize13 u-textUppercase u-letterSpacing1px u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-xs-paddingTop10"><a class="link link--darkenOnHover u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink"   href="https://cloud.google.com/blog/" rel="nofollow noopener" target="_blank">More</a></li></ul></div></div></nav></div></div></div><div class="metabar metabar--spacer js-metabarSpacer  u-height119 u-xs-height110"></div><main role="main"><article class=" u-minHeight100vhOffset65 u-overflowHidden postArticle postArticle--full is-withAccentColors u-marginBottom40"  lang="en"><div class="postArticle-content js-postField js-notesSource js-trackPostScrolls"  data-post-id="5ebb8759a122" data-source="post_page" data-collection-id="e52cf94d98af" data-tracking-context="postPage"><section name="6b46" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="8b01" id="8b01" class="graf graf--h3 graf--leading graf--title">GCP Infrastructure as Code with Deployment Manager</h1><div class="uiScale uiScale-ui--regular uiScale-caption--regular u-flexCenter u-marginVertical24 u-fontSize15 js-postMetaLockup"><div class="u-flex0"><a class="link u-baseColor--link avatar"   href="https://medium.com/@schweikert?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="9954e80b1b09" data-action-type="hover" data-user-id="9954e80b1b09" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/100/100/1*3tFco99l7OeYyMfEl8N4Lg.jpeg" class="avatar-image u-size50x50" alt="Go to the profile of David Schweikert"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><div class="u-paddingBottom3"><a class="ds-link ds-link--styleSubtle ui-captionStrong u-inlineBlock link link--darken link--darker"   href="https://medium.com/@schweikert" data-action="show-user-card" data-action-value="9954e80b1b09" data-action-type="hover" data-user-id="9954e80b1b09" dir="auto">David Schweikert</a><span class="followState js-followState" data-user-id="9954e80b1b09"><button class="button button--smallest u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-xs-hide"  data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--smallest button--dark u-noUserSelect button--withChrome u-accentColor--buttonDark button--follow js-followButton u-marginLeft10 u-xs-hide"  data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/9954e80b1b09" data-action-source="post_header_lockup-9954e80b1b09-------------------------follow_byline"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="ui-caption u-noWrapWithEllipsis js-testPostMetaInlineSupplemental"><time datetime="2018-05-02T05:03:51.242Z">May 1, 2018</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="9 min read"></span></div></div></div><figure name="f2cf" id="f2cf" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 293px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 41.9%;"></div><div class="progressiveMedia js-progressiveMedia graf-image" data-image-id="1*c71MGBJTmz_XvqrY1rUbIg.png" data-width="1816" data-height="760" data-action="zoom" data-action-value="1*c71MGBJTmz_XvqrY1rUbIg.png"><img src="https://cdn-images-1.medium.com/freeze/max/60/1*c71MGBJTmz_XvqrY1rUbIg.png?q=20" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/1600/1*c71MGBJTmz_XvqrY1rUbIg.png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/1600/1*c71MGBJTmz_XvqrY1rUbIg.png"></noscript></div></div></figure><p name="d0c7" id="d0c7" class="graf graf--p graf-after--figure">Infrastructure as code is the practice of making the configuration of your infrastructure reproducible, scalable, and easy to review, by describing it using code. Infrastructure as code comes from the realization that infrastructure is also “software”, which is particularly true for the public cloud. Because it is software, it should by also version-controlled, tested, and reviewed. Even better, you can start putting the description of the required infrastructure together with the code of the application, and have thus a complete definition of all that is required in one place. You can start testing and deploying everything together.</p><p name="57a0" id="57a0" class="graf graf--p graf-after--p">There are many tools available that help you achieve this, including for example Ansible and Terraform, but they don’t always provide a perfect match to what is available on public cloud hosting platforms such as AWS, Azure, or Google Cloud Platform. That should be no surprise, considering the incredible pace of new features that are being introduced. That’s the reason why some cloud providers also give you their own infrastructure as code tools, as part of their offering. AWS has “Amazon Cloud Formation”, Azure has “Azure Resource Manager”, and for the Google Cloud there is “Deployment Manager”. They all provide a way to define your cloud infrastructure resources using a declarative language, which you can then put in a git repository, for example. Also, you can use templates, which allows you to avoid code duplication, and makes it possible to test the same infrastructure code in various stages of deployment.</p><p name="7a27" id="7a27" class="graf graf--p graf-after--p">In this article, we will focus on Google Cloud Platform and how you can use Google Cloud Deployment Manager to automate the configuration of all your GCP resources. As a practical demonstration, we will deploy a Kubernetes cluster and a simple application running on it, all created automatically. It includes the following resources:</p><ul class="postList"><li name="b220" id="b220" class="graf graf--li graf-after--p">a Kubernetes cluster (Google Kubernetes Engine)</li><li name="a4bd" id="a4bd" class="graf graf--li graf-after--li">a Kubernetes deployment</li><li name="99f1" id="99f1" class="graf graf--li graf-after--li">a Kubernetes service</li><li name="6c02" id="6c02" class="graf graf--li graf-after--li">a Kubernetes ingress definition</li></ul><h4 name="c036" id="c036" class="graf graf--h4 graf-after--li">Deployment Manager Basics</h4><p name="4a59" id="4a59" class="graf graf--p graf-after--h4">Before we start with the creation of GCP resources using Deployment Manager, let’s start with a very quick summary of how it works.</p><p name="0ba1" id="0ba1" class="graf graf--p graf-after--p">Deployment Manager has the concept of a <em class="markup--em markup--p-em">deployment</em>, which is a collection of GCP resources that form a logical unit and that are deployed together. The resources of a deployment can be anything available on GCP: VMs, IP addresses, database servers, Kubernetes clusters, etc.</p><p name="7f7a" id="7f7a" class="graf graf--p graf-after--p">In order to create a deployment, you need a <em class="markup--em markup--p-em">deployment configuration</em>, which is a YAML file containing the definition of the resources. To give you an idea, it could look as follows:</p><pre name="5cb4" id="5cb4" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">resources:<br>- name: example-vm<br>  type: compute.v1.instance<br>  properties:<br>    zone: europe-west1-b<br>    machineType: zones/europe-west1-b/machineTypes/n1-standard-1<br>    disks:<br>       ...</code></pre><p name="f2cb" id="f2cb" class="graf graf--p graf-after--pre">Each listed resource always has a <em class="markup--em markup--p-em">type</em>, which is the kind of resource that will be created (a VM, an IP address, etc.), a <em class="markup--em markup--p-em">name</em>, and <em class="markup--em markup--p-em">properties</em> describing with what parameters the resource should be created.</p><p name="e686" id="e686" class="graf graf--p graf-after--p">An important concept, in comparison to say Ansible, is that when you create a deployment, it exists as a resource itself inside GCP. If you later change the configuration of the deployment (by modifying the YAML file, for example), and run the update command, deployment manager will compare the new configuration to what it deployed before, and will only make the required changes. Not only less work needs to be done, but more importantly, it also ensures that any removed resources from the configuration, will also be removed from the GCP infrastructure.</p><p name="51af" id="51af" class="graf graf--p graf-after--p">You can find many deployment configuration examples at the <a href="https://github.com/GoogleCloudPlatform/deploymentmanager-samples" data-href="https://github.com/GoogleCloudPlatform/deploymentmanager-samples" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Google Deployment Manager samples</a> project on GitHub. It is often more useful than the <a href="https://cloud.google.com/deployment-manager/docs/" data-href="https://cloud.google.com/deployment-manager/docs/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">official documentation</a>, to find out exactly what parameters you should define.</p><h4 name="ed89" id="ed89" class="graf graf--h4 graf-after--p">Preparations (if you want to execute the code)</h4><p name="a080" id="a080" class="graf graf--p graf-after--h4">If you want to learn how deployment manager works, I suggest that you also try to deploy this example application when reading along. You will see, how incredibly quick and easy it is to deploy all of these components. What would take usually days to set up, will only need minutes. If you want to do that, prepare as follows:</p><p name="0076" id="0076" class="graf graf--p graf-after--p">First of all, make sure that you have a GCP account and a GCP project with billing enabled. Also, you will need the <a href="https://cloud.google.com/sdk/" data-href="https://cloud.google.com/sdk/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Google Cloud SDK</a> installed, which includes the “gcloud” command-line tool that we will use.</p><pre name="a7ba" id="a7ba" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud auth login<br>$ gcloud config set project $MYPROJECT_ID</code></pre><p name="39ca" id="39ca" class="graf graf--p graf-after--pre">Next, clone the github repo that I prepared with all the code examples in this article:</p><pre name="9580" id="9580" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ git clone https://github.com/schweikert/gcp-infra-as-code<br>$ cd gcp-infra-as-code</code></pre><h4 name="5061" id="5061" class="graf graf--h4 graf-after--pre">Creating a Kubernetes cluster</h4><p name="6719" id="6719" class="graf graf--p graf-after--h4">The first thing that we will do, is to create a Kubernetes cluster. You can find in the <a href="https://cloud.google.com/deployment-manager/docs/configuration/supported-resource-types" data-href="https://cloud.google.com/deployment-manager/docs/configuration/supported-resource-types" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">list of supported resources</a> that the name of the resource in deployment manager is “container.v1.cluster”. A very simple definition looks as follows:</p><pre name="0f32" id="0f32" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">resources:<br><br>- name: cluster<br>  type: container.v1.cluster<br>  properties:<br>    zone: europe-west1-b<br>    cluster:<br>      description: &quot;My example cluster&quot;<br>      initialNodeCount: 2</code></pre><p name="fc0c" id="fc0c" class="graf graf--p graf-after--pre">This would create a Kubernetes cluster in a single zone with 2 nodes.</p><p name="35b5" id="35b5" class="graf graf--p graf-after--p">The <a href="https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-1/cluster.yaml" data-href="https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-1/cluster.yaml" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">cluster.yaml</a> file in the github repository specifies a few more parameters, such as distributing the nodes across two zones and enabling “auto-upgrade” for the cluster nodes.</p><p name="1836" id="1836" class="graf graf--p graf-after--p">You can instantiate this deployment by using the “create” command:</p><pre name="2b15" id="2b15" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud deployment-manager deployments create example-cluster --config cluster-1/cluster.yaml</code></pre><p name="08af" id="08af" class="graf graf--p graf-after--pre">This creates a deployment called “example-cluster”, using the definition found in cluster-1/cluster.yaml. You can later then update the yaml file, and update the deployed deployment with the “update” command:</p><pre name="fed9" id="fed9" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud deployment-manager deployments update example-cluster --config cluster-1/cluster.yaml</code></pre><p name="d8a9" id="d8a9" class="graf graf--p graf-after--pre">This command compares the deployed deployment with the new definition and executes only the needed changes (for example creates a new resource that you added).</p><p name="5c0f" id="5c0f" class="graf graf--p graf-after--p">For now, delete the cluster. We will re-create it again later.</p><pre name="c312" id="c312" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud deployment-manager deployments delete example-cluster</code></pre><h4 name="d814" id="d814" class="graf graf--h4 graf-after--pre">Templating</h4><p name="2125" id="2125" class="graf graf--p graf-after--h4">These yaml files are actually your infrastructure “code”, and you probably want to test that code first, before deploying it. For this to be effective, you should deploy the same code both for testing and for production, even though these environments might need a few parameters to be specified differently.</p><p name="ccd8" id="ccd8" class="graf graf--p graf-after--p">That’s where templating becomes very useful. You can have a single template used for all your environments, and just parametrize what needs to be different. Deployment Manager supports Python scripts and Jinja 2 as templating language. I will demonstrate templating using Jinja 2 because even though Python is recommended by Google, I find Jinja 2 much more adequate and easy to read for this use case.</p><p name="273a" id="273a" class="graf graf--p graf-after--p">The “cluster-2” directory contains the same example but split into two files.</p><p name="3be0" id="3be0" class="graf graf--p graf-after--p">The <a href="https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/example-cluster.yaml" data-href="https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/example-cluster.yaml" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">resource definition</a>:</p><pre name="5b97" id="5b97" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">imports:<br>- path: templates/cluster.jinja<br>  name: cluster.jinja<br><br>resources:<br>- name: example-cluster<br>  type: cluster.jinja<br>  properties:<br>    description: &quot;Example Cluster&quot;<br>    zones:<br>    - europe-west3-b  <br>    - europe-west3-c<br>    initialNodeCount: 1</code></pre><p name="3a8c" id="3a8c" class="graf graf--p graf-after--pre">This file has a structure very similar to the non-templated version, but instead of instantiating GCP resources directly, it instantiates a template. That template instance also has a name and properties, which can then be used in the template definition.</p><p name="9ef4" id="9ef4" class="graf graf--p graf-after--p">The <a href="https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/templates/cluster.jinja" data-href="https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/templates/cluster.jinja" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">template</a>:</p><pre name="cf38" id="cf38" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">resources:<br><br>- name: {{ env[&#39;name&#39;] }}<br>  type: container.v1.cluster<br>  properties:<br>    zone: {{ properties[&#39;zones&#39;][0] }}<br>    ...</code></pre><p name="55f5" id="55f5" class="graf graf--p graf-after--pre">With the Jinja 2 syntax, the template instance name and properties are used to parametrize it.</p><p name="25a0" id="25a0" class="graf graf--p graf-after--p">The command to create the deployment is the same as before:</p><pre name="e277" id="e277" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud deployment-manager deployments create example-cluster --config cluster-2/example-cluster.yaml</code></pre><h4 name="0959" id="0959" class="graf graf--h4 graf-after--pre">Deployment Manager and 3rd-Party Resources</h4><p name="d9c3" id="d9c3" class="graf graf--p graf-after--h4">An amazing ability of Deployment Manager is that you can teach it to manage any kind of resource that you want, besides what it already knows about. Provided that the API to manage these resources fulfills <a href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/process-adding-api" data-href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/process-adding-api" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">some criteria</a>, you can add that API and define third-party resource also as part of your Deployment Manager deployments.</p><p name="8ba3" id="8ba3" class="graf graf--p graf-after--p">One very interesting use-case for this is the management of Kubernetes resources. Deployment manager doesn’t know out of the box how to create, modify or delete Kubernetes resources of a Kubernetes cluster, but you can add code to make it possible.</p><p name="0bf4" id="0bf4" class="graf graf--p graf-after--p">Kubernetes resources are managed by interacting with Kubernetes via a well-defined and versioned API. To make it at the same time extensible, but also backward compatible, there are multiple API endpoints which reflect the scope and maturity of the managed resources. For example, “services” are part of the core functionality and are considered mature, as such methods to manage service resources are part of the API endpoint “/api/v1”. Other more recently added resource types are found at other endpoints: “deployments” are considered beta and are managed with the API endpoint “/apis/extensions/v1beta1”.</p><p name="5063" id="5063" class="graf graf--p graf-after--p">For each of these API endpoints, we will need to add instructions for Deployment Manager, so that it knows about how to use it. The needed code for that is usually deployed as part of the cluster deployment so that as soon as you have created the cluster, you can also start managing Kubernetes resources in it.</p><p name="acb7" id="acb7" class="graf graf--p graf-after--p">The “cluster-3” example contains an additional part that will make it possible to deploy Kubernetes resources. If you look at the “cluster-3/templates/cluster.jinja” file, you will find this:</p><pre name="9311" id="9311" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">{% set K8S_ENDPOINTS = {<br>      &#39;&#39;: &#39;api/v1&#39;,<br>      &#39;-apps&#39;: &#39;apis/apps/v1&#39;,<br>      &#39;-rbac&#39;: &#39;apis/rbac.authorization.k8s.io/v1&#39;,<br>      &#39;-v1beta1-extensions&#39;: &#39;apis/extensions/v1beta1&#39;<br>} %}<br><br>...<br><br>{% for typeSuffix, endpoint in K8S_ENDPOINTS.iteritems() %}<br>- name: {{ env[&#39;name&#39;] }}-type{{ typeSuffix }}<br>  type: deploymentmanager.v2beta.typeProvider<br>  properties:<br>    ...<br>    descriptorUrl: https://$(ref.{{ env[&#39;name&#39;] }}.endpoint)/swaggerapi/{{ endpoint }}<br>{% endfor %}</code></pre><p name="4a2d" id="4a2d" class="graf graf--p graf-after--pre">We won’t go into the details, but you can see that it uses a Jinja loop to create definitions for each of the API endpoints that we want to use. It uses a Swagger or OpenAPI URL to discover what methods are available at each endpoint, and how to call them. The first iteration of the loop in the template will produce this:</p><pre name="0b2a" id="0b2a" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">- name: example-cluster-type<br>  type: deploymentmanager.v2beta.typeProvider<br>  properties:<br>    descriptorUrl: https://$(ref.example-cluster.endpoint)/swaggerapi/api/v1<br>    ...</code></pre><p name="068c" id="068c" class="graf graf--p graf-after--pre">The <code class="markup--code markup--p-code">$(ref.example-cluster.endpoint)</code> is an inline-reference and resolves at deploy-time to a property (“endpoint”) of a created resource (“example-cluster”). In this case, it resolves to the IP address of the Kubernetes master service. What it also does, is set a dependency between these two resources (<code class="markup--code markup--p-code">example-cluster-type</code> and <code class="markup--code markup--p-code">example-cluster</code>), and deployment manager will make sure that the resources are created in the right order.</p><p name="1c7d" id="1c7d" class="graf graf--p graf-after--p">The <code class="markup--code markup--p-code">descriptorUrl</code> becomes something like: <code class="markup--code markup--p-code">https://35.198.131.165/swaggerapi/api/v1</code>, and is used to resolve the api/v1” methods of Kubernetes. The example contains three further API endpoints, and you can extend it as you need (i.e. according to the APIs that you need to access for your deployment).</p><p name="212e" id="212e" class="graf graf--p graf-after--p">You can start using these new resource types in the same deployment, or also in new deployments that you create in the same project.</p><p name="dda2" id="dda2" class="graf graf--p graf-after--p">After the cluster is deployed, you can see the new types either in the GCP Console (note that there is a section dedicated to the Deployment Manager), or using the gcloud tool:</p><pre name="add4" id="add4" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud deployment-manager types list | grep example<br>example-cluster-type<br>example-cluster-type-apps<br>example-cluster-type-rbac<br>example-cluster-type-v1beta1-extensions</code></pre><h4 name="2d28" id="2d28" class="graf graf--h4 graf-after--pre">A Kubernetes Application</h4><p name="b894" id="b894" class="graf graf--p graf-after--h4">Now we are finally ready to create a Kubernetes application using Deployment Manager. We will define three resources: a Kubernetes “deployment” with a pod specification, a service, and an ingress to make the application accessible from outside the cluster.</p><p name="5880" id="5880" class="graf graf--p graf-after--p">As you can see in the <a href="https://github.com/schweikert/gcp-infra-as-code/blob/master/hello-world-1/templates/hello-world.jinja" data-href="https://github.com/schweikert/gcp-infra-as-code/blob/master/hello-world-1/templates/hello-world.jinja" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">template file</a>, each Kubernetes resource is created by referencing one of the above API-based types that we defined as part of the cluster deployment. For example:</p><pre name="e835" id="e835" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">- name: example-hello-world-svc<br>  type: env[‘project’]/example-cluster-type:/api/v1/namespaces/{namespace}/services<br>  properties:<br>    apiVersion: v1<br>    kind: Service</code></pre><p name="074d" id="074d" class="graf graf--p graf-after--pre">Some macros are used to make it a bit easier to write the resources (NAME_PREFIX, CLUSTER_TYPE, etc.).</p><p name="8fed" id="8fed" class="graf graf--p graf-after--p">You can deploy the template with the 3 Kubernetes resources as follows:</p><pre name="650b" id="650b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud deployment-manager deployments update example-hello-world --config hello-world-1/example.yaml</code></pre><p name="2819" id="2819" class="graf graf--p graf-after--pre">GCP will assign automatically an ephemeral static IP address to access your application. You can find out what it is using the kubectl command, but first you need to get the needed credentials for it:</p><pre name="44c5" id="44c5" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ gcloud container clusters get-credentials example-cluster --zone europe-west1-b<br><br>$ kubectl get pod                              <br>NAME                                   READY     STATUS    RESTARTS   AGE                                                <br>hello-world-example-75d79ccdd5-pmjcg   1/1       Running   0          1m<br>hello-world-example-75d79ccdd5-vtb6g   1/1       Running   0          1m</code></pre><p name="3452" id="3452" class="graf graf--p graf-after--pre">Now you can look at the ingress resource to find out the external IP address:</p><pre name="7274" id="7274" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ kubectl get ingress -o wide<br>NAME                  HOSTS     ADDRESS         PORTS     AGE<br>hello-world-example   *         35.201.65.191   80        10m</code></pre><p name="00f7" id="00f7" class="graf graf--p graf-after--pre">… and access your application here: <a href="http://35.201.65.191." data-href="http://35.201.65.191." class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">http://35.201.65.191.</a></p><p name="fe13" id="fe13" class="graf graf--p graf-after--p">Voilà, a fully reproducible Kubernetes cluster and application described as code :)</p><p name="707a" id="707a" class="graf graf--p graf-after--p">To continue experimenting with Deployment Manager, you could have a look at Google KMS, which allows you to encrypt secrets using a key that you store in GCP (so that you can put encrypted values in your configuration files), and generate for example Kubernetes secrets using that. Also something that I already tested and works well, is creating a PostgreSQL database and deploying the Cloud SQL Proxy with a service account that is generated via deployment manager. Let me know if you would be interesting in reading an article about that.</p><p name="cdbc" id="cdbc" class="graf graf--p graf-after--p graf--trailing">Don’t forget to clean up everything after you have finished experimenting so that you don’t waste GCP credits.</p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"><div class="postMetaInline postMetaInline--acknowledgments u-paddingTop5 u-paddingBottom20 js-postMetaAcknowledgments"><a class="link u-baseColor--link"   href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license cc:license" target="_blank" data-tooltip="Except where otherwise noted, this work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International license by the author.">Some rights reserved</a><span class="postMetaInline-licenseIcons u-marginLeft5"><span title="You can distribute, remix, and build upon this work as long as you credit the author."><span class="svgIcon svgIcon--creativeCommonsBy svgIcon--21px"><svg class="svgIcon-use" width="21" height="21" ><path d="M10.485 2c2.387 0 4.4.82 6.04 2.46C18.175 6.107 19 8.12 19 10.5c0 2.388-.81 4.376-2.43 5.965C14.85 18.155 12.823 19 10.486 19c-2.298 0-4.29-.835-5.98-2.505C2.836 14.825 2 12.827 2 10.5s.835-4.34 2.505-6.04C6.145 2.82 8.137 2 10.485 2zm.03 1.533c-1.933 0-3.567.678-4.903 2.034-1.386 1.417-2.08 3.06-2.08 4.933 0 1.882.69 3.512 2.065 4.887 1.376 1.377 3.015 2.064 4.918 2.064 1.892 0 3.54-.69 4.948-2.07 1.336-1.28 2.004-2.91 2.004-4.87 0-1.93-.68-3.57-2.034-4.93-1.356-1.35-2.995-2.03-4.918-2.03zm2.277 4.857v3.476h-.97v4.128H9.18v-4.128h-.972V8.39a.53.53 0 0 1 .16-.387.528.528 0 0 1 .387-.16h3.49c.143 0 .27.054.38.16a.52.52 0 0 1 .167.387zM9.316 6.205c0-.8.394-1.2 1.184-1.2.79 0 1.184.4 1.184 1.2 0 .79-.395 1.183-1.184 1.183-.79 0-1.184-.394-1.184-1.183z" fill-rule="evenodd"/></svg></span></span><span title="You must distribute derivatives of this work under the same license."><span class="svgIcon svgIcon--creativeCommonsSa svgIcon--21px"><svg class="svgIcon-use" width="21" height="21" ><path d="M10.485 2c2.377 0 4.39.825 6.04 2.474C18.175 6.114 19 8.122 19 10.5c0 2.378-.81 4.37-2.43 5.98-1.71 1.68-3.738 2.52-6.085 2.52-2.298 0-4.29-.835-5.98-2.505C2.835 14.825 2 12.828 2 10.5c0-2.317.835-4.325 2.505-6.025C6.155 2.825 8.147 2 10.485 2zm.03 1.533c-1.933 0-3.567.683-4.903 2.05-1.386 1.406-2.08 3.045-2.08 4.917 0 1.893.69 3.52 2.065 4.887 1.376 1.377 3.015 2.065 4.918 2.065 1.892 0 3.54-.693 4.948-2.08 1.336-1.295 2.004-2.92 2.004-4.872 0-1.943-.68-3.582-2.034-4.918-1.346-1.366-2.985-2.05-4.918-2.05zM6.72 9.3c.162-1.042.582-1.85 1.26-2.42.678-.572 1.502-.858 2.474-.858 1.335 0 2.398.43 3.188 1.29.79.86 1.183 1.963 1.183 3.31 0 1.305-.41 2.39-1.23 3.255-.82.864-1.88 1.297-3.187 1.297-.96 0-1.79-.288-2.49-.865-.697-.58-1.117-1.4-1.26-2.46H8.8c.05 1.03.673 1.55 1.867 1.55.597 0 1.078-.26 1.442-.78.36-.52.54-1.21.54-2.07 0-.9-.17-1.59-.5-2.06-.34-.47-.82-.71-1.45-.71-1.14 0-1.77.5-1.92 1.5h.62l-1.68 1.68-1.68-1.68h.66z" fill-rule="evenodd"/></svg></span></span></span> </div></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link"   href="https://medium.com/tag/google-cloud-platform?source=post" data-action-source="post">Google Cloud Platform</a></li><li><a class="link u-baseColor--link"   href="https://medium.com/tag/kubernetes?source=post" data-action-source="post">Kubernetes</a></li><li><a class="link u-baseColor--link"   href="https://medium.com/tag/infrastructure-as-code?source=post" data-action-source="post">Infrastructure As Code</a></li></ul></div></div></div><div class="postActions js-postActionsFooter "><div class="u-flexCenter"><div class="u-flex1"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="5ebb8759a122" data-is-icon-29px="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_actions_footer-----5ebb8759a122---------------------clap_footer" data-clap-string-singular="clap" data-clap-string-plural="claps"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--darker clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal clap-onboardingcollection"  data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/5ebb8759a122" data-action-source="post_actions_footer-----5ebb8759a122---------------------clap_footer" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33" ><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33" ><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"/><path d="M13.285.48l-1.916.881 2.37 2.837z"/><path d="M21.719 1.361L19.79.501l-.44 3.697z"/><path d="M16.502 3.298L15.481 0h2.043z"/></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Springu-backgroundGrayLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight"  data-action="multivote-undo" data-action-value="5ebb8759a122"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"/></svg></span></button></div></div><span class="u-relative u-background js-actionMultirecommendCount u-marginLeft16"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-textColorDarker"  data-action="show-recommends" data-action-value="5ebb8759a122">169 claps</button><span class="u-xs-hide"></span></span></div></div><div class="buttonSet u-flex0"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless u-xs-hide u-marginRight12"   href="https://medium.com/p/5ebb8759a122/share/twitter" title="Share on Twitter" aria-label="Share on Twitter" target="_blank" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M22.053 7.54a4.474 4.474 0 0 0-3.31-1.455 4.526 4.526 0 0 0-4.526 4.524c0 .35.04.7.082 1.05a12.9 12.9 0 0 1-9.3-4.77c-.39.69-.61 1.46-.65 2.26.03 1.6.83 2.99 2.02 3.79-.72-.02-1.41-.22-2.02-.57-.01.02-.01.04 0 .08-.01 2.17 1.55 4 3.63 4.44-.39.08-.79.13-1.21.16-.28-.03-.57-.05-.81-.08.54 1.77 2.21 3.08 4.2 3.15a9.564 9.564 0 0 1-5.66 1.94c-.34-.03-.7-.06-1.05-.08 2 1.27 4.38 2.02 6.94 2.02 8.31 0 12.86-6.9 12.84-12.85.02-.24.01-.43 0-.65.89-.62 1.65-1.42 2.26-2.34-.82.38-1.69.62-2.59.72a4.37 4.37 0 0 0 1.94-2.51c-.84.53-1.81.9-2.83 1.13z"/></svg></span></span></a><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless u-xs-hide u-marginRight12"   href="https://medium.com/p/5ebb8759a122/share/facebook" title="Share on Facebook" aria-label="Share on Facebook" target="_blank" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookSquare svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M23.209 5H5.792A.792.792 0 0 0 5 5.791V23.21c0 .437.354.791.792.791h9.303v-7.125H12.72v-2.968h2.375v-2.375c0-2.455 1.553-3.662 3.741-3.662 1.049 0 1.95.078 2.213.112v2.565h-1.517c-1.192 0-1.469.567-1.469 1.397v1.963h2.969l-.594 2.968h-2.375L18.11 24h5.099a.791.791 0 0 0 .791-.791V5.79a.791.791 0 0 0-.791-.79"/></svg></span></span></a><button class="button button--large button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-show u-marginRight10"  title="Share this story on Twitter or Facebook" aria-label="Share this story on Twitter or Facebook" data-action="show-share-popover" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--share svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M20.385 8H19a.5.5 0 1 0 .011 1h1.39c.43 0 .84.168 1.14.473.31.305.48.71.48 1.142v10.77c0 .43-.17.837-.47 1.142-.3.305-.71.473-1.14.473H8.62c-.43 0-.84-.168-1.144-.473a1.603 1.603 0 0 1-.473-1.142v-10.77c0-.43.17-.837.48-1.142A1.599 1.599 0 0 1 8.62 9H10a.502.502 0 0 0 0-1H8.615c-.67 0-1.338.255-1.85.766-.51.51-.765 1.18-.765 1.85v10.77c0 .668.255 1.337.766 1.848.51.51 1.18.766 1.85.766h11.77c.668 0 1.337-.255 1.848-.766.51-.51.766-1.18.766-1.85v-10.77c0-.668-.255-1.337-.766-1.848A2.61 2.61 0 0 0 20.384 8zm-8.67-2.508L14 3.207v8.362c0 .27.224.5.5.5s.5-.23.5-.5V3.2l2.285 2.285a.49.49 0 0 0 .704-.001.511.511 0 0 0 0-.708l-3.14-3.14a.504.504 0 0 0-.71 0L11 4.776a.501.501 0 0 0 .71.706" fill-rule="evenodd"/></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"/></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal u-marginRight12"  data-action="scroll-to-responses">3</button><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton"  title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/5ebb8759a122" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px u-marginRight4"><svg class="svgIcon-use" width="29" height="29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px u-marginRight4"><svg class="svgIcon-use" width="29" height="29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon js-moreActionsButton"  title="More actions" aria-label="More actions" data-action="more-actions"><span class="svgIcon svgIcon--more svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"  viewBox="-480.5 272.5 21 21"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"/></svg></span></button></div></div></div></div><div class="u-maxWidth740 u-paddingTop20 u-marginTop20 u-borderTopLightest container u-paddingBottom20 u-xs-paddingBottom10 js-postAttributionFooterContainer"><div class="row js-postFooterInfo"><div class="col u-size6of12 u-xs-size12of12"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState" data-user-id="9954e80b1b09"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton"  data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton"  data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/9954e80b1b09" data-action-source="footer_card-9954e80b1b09-------------------------follow_footer"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell"><a class="link u-baseColor--link avatar"   href="https://medium.com/@schweikert?source=footer_card" title="Go to the profile of David Schweikert" aria-label="Go to the profile of David Schweikert" data-action-source="footer_card" data-user-id="9954e80b1b09" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/120/120/1*3tFco99l7OeYyMfEl8N4Lg.jpeg" class="avatar-image avatar-image--small" alt="Go to the profile of David Schweikert"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal"   href="https://medium.com/@schweikert" property="cc:attributionName" title="Go to the profile of David Schweikert" aria-label="Go to the profile of David Schweikert" rel="author cc:attributionUrl" data-user-id="9954e80b1b09" dir="auto">David Schweikert</a></h3><p class="ui-body u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Cloud Infrastructure Engineer, Open Source Developer</p></div></li></div><div class="col u-size6of12 u-xs-size12of12 u-xs-marginTop30"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardCollection"><div class="u-marginLeft20 u-floatRight"><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal js-relationshipButton"  data-action="sign-up-prompt" data-sign-in-action="toggle-follow-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/google-cloud" data-action-source="footer_card----e52cf94d98af----------------------follow_footer" data-collection-id="e52cf94d98af"><span class="button-label  js-buttonLabel">Follow</span></button></div><div class="u-tableCell "><a class="link u-baseColor--link avatar avatar--roundedRectangle"   href="https://medium.com/google-cloud?source=footer_card" title="Go to Google Cloud Platform - Community" aria-label="Go to Google Cloud Platform - Community" data-action-source="footer_card"><img src="https://cdn-images-1.medium.com/fit/c/120/120/1*FUjLiCANvATKeaJEeg20Rw.png" class="avatar-image u-size60x60" alt="Google Cloud Platform - Community"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal"   href="https://medium.com/google-cloud?source=footer_card" rel="collection" data-action-source="footer_card">Google Cloud Platform - Community</a></h3><p class="ui-body u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don&#39;t necessarily reflect those of Google.</p><div class="buttonSet"></div></div></li></div></div></div><div class="js-postFooterPlacements" data-post-id="5ebb8759a122" data-collection-id="e52cf94d98af"></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper"></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><aside class="u-marginAuto u-maxWidth1032 js-postLeftSidebar"><div class="u-foreground u-top0 u-transition--fadeOut300 u-fixed u-sm-hide js-postShareWidget"><ul><li class="u-marginVertical10"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="5ebb8759a122" data-is-icon-29px="true" data-has-recommend-list="true" data-source="post_share_widget-----5ebb8759a122---------------------clap_sidebar"><div class="u-relative u-foreground"><button class="button button--primary button--large button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--darker"  data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/5ebb8759a122" data-action-source="post_share_widget-----5ebb8759a122---------------------clap_sidebar" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><g fill-rule="evenodd"><path d="M13.739 1l.761 2.966L15.261 1z"/><path d="M16.815 4.776l1.84-2.551-1.43-.471z"/><path d="M10.378 2.224l1.84 2.551-.408-3.022z"/><path d="M22.382 22.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L6.11 15.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L8.43 9.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L20.628 15c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM12.99 6.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"/></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><g fill-rule="evenodd"><path d="M13.738 1l.762 2.966L15.262 1z"/><path d="M18.634 2.224l-1.432-.47-.408 3.022z"/><path d="M11.79 1.754l-1.431.47 1.84 2.552z"/><path d="M24.472 14.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"/><path d="M14.58 10.887c-.156-.83.096-1.569.692-2.142L12.78 6.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"/><path d="M17.812 10.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L9.2 7.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L7.046 9.54 5.802 8.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394l1.241 1.241 4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L4.89 11.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C21.74 20.8 22.271 18 20.62 14.982l-2.809-4.942z"/></g></svg></span></span></button></div><span class="u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton"  data-action="show-recommends" data-action-value="5ebb8759a122">169</button></span></div></li><li class="u-marginVertical10 u-marginLeft3"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton"  title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/5ebb8759a122" data-action-source="post_share_widget-----5ebb8759a122---------------------bookmark_sidebar"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"/></svg></span></span></button></li><li class="u-marginVertical10 u-marginLeft3"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless"   href="https://medium.com/p/5ebb8759a122/share/twitter" title="Share on Twitter" aria-label="Share on Twitter" target="_blank" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M22.053 7.54a4.474 4.474 0 0 0-3.31-1.455 4.526 4.526 0 0 0-4.526 4.524c0 .35.04.7.082 1.05a12.9 12.9 0 0 1-9.3-4.77c-.39.69-.61 1.46-.65 2.26.03 1.6.83 2.99 2.02 3.79-.72-.02-1.41-.22-2.02-.57-.01.02-.01.04 0 .08-.01 2.17 1.55 4 3.63 4.44-.39.08-.79.13-1.21.16-.28-.03-.57-.05-.81-.08.54 1.77 2.21 3.08 4.2 3.15a9.564 9.564 0 0 1-5.66 1.94c-.34-.03-.7-.06-1.05-.08 2 1.27 4.38 2.02 6.94 2.02 8.31 0 12.86-6.9 12.84-12.85.02-.24.01-.43 0-.65.89-.62 1.65-1.42 2.26-2.34-.82.38-1.69.62-2.59.72a4.37 4.37 0 0 0 1.94-2.51c-.84.53-1.81.9-2.83 1.13z"/></svg></span></span></a></li><li class="u-marginVertical10 u-marginLeft3"><a class="button button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon button--dark button--chromeless"   href="https://medium.com/p/5ebb8759a122/share/facebook" title="Share on Facebook" aria-label="Share on Facebook" target="_blank" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookSquare svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" ><path d="M23.209 5H5.792A.792.792 0 0 0 5 5.791V23.21c0 .437.354.791.792.791h9.303v-7.125H12.72v-2.968h2.375v-2.375c0-2.455 1.553-3.662 3.741-3.662 1.049 0 1.95.078 2.213.112v2.565h-1.517c-1.192 0-1.469.567-1.469 1.397v1.963h2.969l-.594 2.968h-2.375L18.11 24h5.099a.791.791 0 0 0 .791-.791V5.79a.791.791 0 0 0-.791-.79"/></svg></span></span></a></li></ul></div></aside><div class="u-fixed u-bottom0 u-width100pct u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link u-baseColor--link avatar avatar--roundedRectangle"   href="https://medium.com/google-cloud" title="Go to Google Cloud Platform - Community" aria-label="Go to Google Cloud Platform - Community"><img src="https://cdn-images-1.medium.com/fit/c/80/80/1*FUjLiCANvATKeaJEeg20Rw.png" class="avatar-image avatar-image--smaller" alt="Google Cloud Platform - Community"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Google Cloud Platform - Community</strong>, when you sign up for Medium. <a class="link u-baseColor--link link--accent u-accentColor--textNormal u-accentColor--textDarken"   href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Google Cloud Platform - Community</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><button class="button button--primary button--dark is-active u-noUserSelect button--withChrome u-accentColor--buttonDark u-uiTextSemibold u-textUppercase u-fontSize12 button--followCollection js-followCollectionButton"  data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/google-cloud" data-action-source="sticky_footer----e52cf94d98af----------------------follow_metabar"><span class="button-label  button-defaultState js-buttonLabel">Get updates</span><span class="button-label button-activeState">Get updates</span></button></div></div></div><style class="js-collectionStyle">
.u-accentColor--borderLight {border-color: #02B875 !important;}
.u-accentColor--borderNormal {border-color: #02B875 !important;}
.u-accentColor--borderDark {border-color: #1C9963 !important;}
.u-accentColor--iconLight .svgIcon,.u-accentColor--iconLight.svgIcon {fill: #02B875 !important;}
.u-accentColor--iconNormal .svgIcon,.u-accentColor--iconNormal.svgIcon {fill: #02B875 !important;}
.u-accentColor--iconDark .svgIcon,.u-accentColor--iconDark.svgIcon {fill: #1C9963 !important;}
.u-accentColor--textNormal {color: #1C9963 !important;}
.u-accentColor--hoverTextNormal:hover {color: #1C9963 !important;}
.u-accentColor--textNormal.u-accentColor--textDarken:hover {color: #1C9963 !important;}
.u-accentColor--textDark {color: #1C9963 !important;}
.u-accentColor--backgroundLight {background-color: #02B875 !important;}
.u-accentColor--backgroundNormal {background-color: #02B875 !important;}
.u-accentColor--backgroundDark {background-color: #1C9963 !important;}
.u-accentColor--buttonDark {border-color: #1C9963 !important; color: #1C9963 !important;}
.u-accentColor--buttonDark:hover {border-color: #1C9963 !important;}
.u-accentColor--buttonDark .icon:before,.u-accentColor--buttonDark .svgIcon{color: #1C9963 !important; fill: #1C9963 !important;}
.u-accentColor--buttonNormal:not(.clapButton--largePill) {border-color: #02B875 !important; color: #1C9963 !important;}
.u-accentColor--buttonNormal:hover {border-color: #1C9963 !important;}
.u-accentColor--buttonNormal .icon:before,.u-accentColor--buttonNormal .svgIcon{color: #02B875 !important; fill: #02B875 !important;}
.u-accentColor--buttonNormal.button--filled .icon:before,.u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-accentColor--buttonDark.button--filled,.u-accentColor--buttonDark.button--withChrome.is-active,.u-accentColor--fillWhenActive.is-active {background-color: #1C9963 !important; border-color: #1C9963 !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-accentColor--buttonNormal.button--filled:not(.clapButton--largePill),.u-accentColor--buttonNormal.button--withChrome.is-active:not(.clapButton--largePill) {background-color: #02B875 !important; border-color: #02B875 !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.postArticle.is-withAccentColors .markup--user,.postArticle.is-withAccentColors .markup--query {color: #1C9963 !important;}
.u-accentColor--highlightFaint {background-color: rgba(233, 253, 240, 1) !important;}
.u-accentColor--highlightStrong.is-active .svgIcon {fill: rgba(125, 255, 179, 1) !important;}
.postArticle.is-withAccentColors .markup--quote.is-other {background-color: rgba(233, 253, 240, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-other {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(233, 253, 240, 1), rgba(233, 253, 240, 1));}
.postArticle.is-withAccentColors .markup--quote.is-me {background-color: rgba(173, 255, 207, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-me {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(173, 255, 207, 1), rgba(173, 255, 207, 1));}
.postArticle.is-withAccentColors .markup--quote.is-targeted {background-color: rgba(125, 255, 179, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-targeted {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(125, 255, 179, 1), rgba(125, 255, 179, 1));}
.postArticle.is-withAccentColors .markup--quote.is-selected {background-color: rgba(125, 255, 179, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-selected {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(125, 255, 179, 1), rgba(125, 255, 179, 1));}
.postArticle.is-withAccentColors .markup--highlight {background-color: rgba(125, 255, 179, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--highlight {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(125, 255, 179, 1), rgba(125, 255, 179, 1));}.u-baseColor--iconNormal.avatar-halo {fill: rgba(0, 0, 0, 0.4980392156862745) !important;}</style><style class="js-collectionStyleConstant">.u-imageBgColor {background-color: rgba(0, 0, 0, 0.24705882352941178);}
.u-imageSpectrum .u-baseColor--borderLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-baseColor--borderNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-baseColor--borderDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--iconLight .svgIcon,.u-imageSpectrum .u-baseColor--iconLight.svgIcon {fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--iconNormal .svgIcon,.u-imageSpectrum .u-baseColor--iconNormal.svgIcon {fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--iconDark .svgIcon,.u-imageSpectrum .u-baseColor--iconDark.svgIcon {fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textNormal {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textDark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textDarker {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--backgroundLight {background-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-baseColor--backgroundNormal {background-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--backgroundDark {background-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important; color: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--buttonLight:hover {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-baseColor--buttonLight .icon:before,.u-imageSpectrum .u-baseColor--buttonLight .svgIcon {color: rgba(255, 255, 255, 0.8) !important; fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--buttonDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonDark:hover {border-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonDark .icon:before,.u-imageSpectrum .u-baseColor--buttonDark .svgIcon {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important; color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal:hover {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal .icon:before,.u-imageSpectrum .u-baseColor--buttonNormal .svgIcon {color: rgba(255, 255, 255, 0.9490196078431372) !important; fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonDark.button--filled,.u-imageSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: rgba(255, 255, 255, 1) !important; border-color: rgba(255, 255, 255, 1) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal.button--filled,.u-imageSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: rgba(255, 255, 255, 0.9490196078431372) !important; border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-baseColor--link {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--darken:hover,.u-imageSpectrum .u-baseColor--link.link--darken:focus,.u-imageSpectrum .u-baseColor--link.link--darken:active {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--dark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:active {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--darker {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .svgIcon--logoWordmark {stroke: none !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .svgIcon--logoMonogram {stroke: none !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum  .ui-h1,.u-imageSpectrum  .ui-h2,.u-imageSpectrum  .ui-h3,.u-imageSpectrum  .ui-h4,.u-imageSpectrum  .ui-brand1,.u-imageSpectrum  .ui-brand2,.u-imageSpectrum  .ui-captionStrong {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum  .ui-body,.u-imageSpectrum  .ui-caps {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum  .ui-summary,.u-imageSpectrum  .ui-caption {color: rgba(255, 255, 255, 0.8) !important; fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-accentColor--borderLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--iconLight .svgIcon,.u-imageSpectrum .u-accentColor--iconLight.svgIcon {fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-accentColor--iconNormal .svgIcon,.u-imageSpectrum .u-accentColor--iconNormal.svgIcon {fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--iconDark .svgIcon,.u-imageSpectrum .u-accentColor--iconDark.svgIcon {fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--textNormal {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--hoverTextNormal:hover {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--textDark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--backgroundLight {background-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--backgroundNormal {background-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--backgroundDark {background-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark:hover {border-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark .icon:before,.u-imageSpectrum .u-accentColor--buttonDark .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal:not(.clapButton--largePill) {border-color: rgba(255, 255, 255, 0.8980392156862745) !important; color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal:hover {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal .icon:before,.u-imageSpectrum .u-accentColor--buttonNormal .svgIcon{color: rgba(255, 255, 255, 0.9490196078431372) !important; fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-imageSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-accentColor--buttonDark.button--filled,.u-imageSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-imageSpectrum .u-accentColor--fillWhenActive.is-active {background-color: rgba(255, 255, 255, 1) !important; border-color: rgba(255, 255, 255, 1) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal.button--filled:not(.clapButton--largePill),.u-imageSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active:not(.clapButton--largePill) {background-color: rgba(255, 255, 255, 0.9490196078431372) !important; border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .postArticle.is-withAccentColors .markup--user,.u-imageSpectrum .postArticle.is-withAccentColors .markup--query {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--highlightFaint {background-color: rgba(255, 255, 255, 0.2) !important;}
.u-imageSpectrum .u-accentColor--highlightStrong.is-active .svgIcon {fill: rgba(255, 255, 255, 0.6) !important;}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-other {background-color: rgba(255, 255, 255, 0.2) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-other {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-me {background-color: rgba(255, 255, 255, 0.4) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-me {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.4));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-targeted {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-targeted {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-selected {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-selected {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--highlight {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--highlight {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}.u-resetSpectrum .u-tintBgColor {background-color: rgba(255, 255, 255, 1) !important;}.u-resetSpectrum .u-tintBgColor .u-fadeLeft:before {background-image: linear-gradient(to right, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%) !important;}.u-resetSpectrum .u-tintBgColor .u-fadeRight:after {background-image: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%) !important;}
.u-resetSpectrum .u-baseColor--borderLight {border-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--borderNormal {border-color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--borderDark {border-color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--iconLight .svgIcon,.u-resetSpectrum .u-baseColor--iconLight.svgIcon {fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--iconNormal .svgIcon,.u-resetSpectrum .u-baseColor--iconNormal.svgIcon {fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--iconDark .svgIcon,.u-resetSpectrum .u-baseColor--iconDark.svgIcon {fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textNormal {color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textDark {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textDarker {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--backgroundLight {background-color: rgba(0, 0, 0, 0.09803921568627451) !important;}
.u-resetSpectrum .u-baseColor--backgroundNormal {background-color: rgba(0, 0, 0, 0.2) !important;}
.u-resetSpectrum .u-baseColor--backgroundDark {background-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight {border-color: rgba(0, 0, 0, 0.2980392156862745) !important; color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight:hover {border-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight .icon:before,.u-resetSpectrum .u-baseColor--buttonLight .svgIcon {color: rgba(0, 0, 0, 0.2980392156862745) !important; fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonDark {border-color: rgba(0, 0, 0, 0.6) !important; color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonDark:hover {border-color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--buttonDark .icon:before,.u-resetSpectrum .u-baseColor--buttonDark .svgIcon {color: rgba(0, 0, 0, 0.6) !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal {border-color: rgba(0, 0, 0, 0.4980392156862745) !important; color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal:hover {border-color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal .icon:before,.u-resetSpectrum .u-baseColor--buttonNormal .svgIcon {color: rgba(0, 0, 0, 0.4980392156862745) !important; fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonDark.button--filled,.u-resetSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: rgba(0, 0, 0, 0.2980392156862745) !important; border-color: rgba(0, 0, 0, 0.2980392156862745) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal.button--filled,.u-resetSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: rgba(0, 0, 0, 0.2) !important; border-color: rgba(0, 0, 0, 0.2) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-baseColor--link {color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--darken:hover,.u-resetSpectrum .u-baseColor--link.link--darken:focus,.u-resetSpectrum .u-baseColor--link.link--darken:active {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--dark {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:active {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--link.link--darker {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .svgIcon--logoWordmark {stroke: none !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .svgIcon--logoMonogram {stroke: none !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum  .ui-h1,.u-resetSpectrum  .ui-h2,.u-resetSpectrum  .ui-h3,.u-resetSpectrum  .ui-h4,.u-resetSpectrum  .ui-brand1,.u-resetSpectrum  .ui-brand2,.u-resetSpectrum  .ui-captionStrong {color: rgba(0, 0, 0, 0.8) !important; fill: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum  .ui-body,.u-resetSpectrum  .ui-caps {color: rgba(0, 0, 0, 0.6) !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum  .ui-summary,.u-resetSpectrum  .ui-caption {color: rgba(0, 0, 0, 0.2980392156862745) !important; fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-accentColor--borderLight {border-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--borderNormal {border-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--borderDark {border-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--iconLight .svgIcon,.u-resetSpectrum .u-accentColor--iconLight.svgIcon {fill: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--iconNormal .svgIcon,.u-resetSpectrum .u-accentColor--iconNormal.svgIcon {fill: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--iconDark .svgIcon,.u-resetSpectrum .u-accentColor--iconDark.svgIcon {fill: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--textNormal {color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--hoverTextNormal:hover {color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--textDark {color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundLight {background-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundNormal {background-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundDark {background-color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark {border-color: rgba(0, 171, 107, 1) !important; color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark:hover {border-color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark .icon:before,.u-resetSpectrum .u-accentColor--buttonDark .svgIcon{color: rgba(28, 153, 99, 1) !important; fill: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal:not(.clapButton--largePill) {border-color: rgba(2, 184, 117, 1) !important; color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal:hover {border-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal .icon:before,.u-resetSpectrum .u-accentColor--buttonNormal .svgIcon{color: rgba(0, 171, 107, 1) !important; fill: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-resetSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark.button--filled,.u-resetSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-resetSpectrum .u-accentColor--fillWhenActive.is-active {background-color: rgba(28, 153, 99, 1) !important; border-color: rgba(28, 153, 99, 1) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal.button--filled:not(.clapButton--largePill),.u-resetSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active:not(.clapButton--largePill) {background-color: rgba(0, 171, 107, 1) !important; border-color: rgba(0, 171, 107, 1) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .postArticle.is-withAccentColors .markup--user,.u-resetSpectrum .postArticle.is-withAccentColors .markup--query {color: rgba(0, 171, 107, 1) !important;}</style></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"37096-afb7b32","currentUser":{"userId":"lo_cb6313db35f1","isVerified":false,"subscriberEmail":"","hasPastMemberships":false,"isEnrolledInHightower":false,"isEligibleForHightower":false,"hightowerLastLockedAt":0,"isWriterProgramEnrolled":false,"isWriterProgramInvited":false,"isWriterProgramOptedOut":false,"writerProgramVersion":0,"writerProgramEnrolledAt":0,"friendLinkOnboarding":0,"hasAdditionalUnlocks":false,"hasApiAccess":false,"isQuarantined":false,"writerProgramDistributionSettingOptedIn":false},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"language":"en-gb","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.mYfzFXJfx9gfVir2rwCc7A.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.icDe_dX5-v34upoM-FUiJQ.js","hightower":"https://cdn-static-1.medium.com/_/fp/gen-js/main-hightower.bundle.kb--C7aBt2oWkuumbnkHXg.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.QJVz0-GIHZlVB1bRmnbuxw.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.rUU7MpNXdTdWVBCVMCN_Xg.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.xAT46ZADKf085dJKY7Tj9Q.js","payments":"https://cdn-static-1.medium.com/_/fp/gen-js/main-payments.bundle.F21bIW6ck5qc67ZvX7BLog.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.68B789BsfSotL_O7FS5t_g.js","power-readers":"https://cdn-static-1.medium.com/_/fp/gen-js/main-power-readers.bundle.9g-vY5VXfJyBOKmG5U03vg.js","pubs":"https://cdn-static-1.medium.com/_/fp/gen-js/main-pubs.bundle.pPmJNwGK6PWt2VVI23NOXg.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.oopnONQAYWDKEZkSaK738w.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":true,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1554362033248:85f944f39f40","useragent":{"browser":"chromium","family":"chrome","os":"","version":73,"supportsDesktopEdit":true,"supportsInteract":true,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":true,"isTier1":true,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":true,"supportsVhUnits":true,"ruinsViewportSections":false,"supportsHtml5Video":true,"supportsMagicUnderlines":true,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":true,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":false,"supportsVideoSections":true,"emojiSupportLevel":1,"isSearchBot":false,"isSyndicationBot":false,"isNativeAndroid":false,"supportsScrollableMetabar":true},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv,google-one-tap","signup_services":"twitter,facebook,google,email,google-fastidv,google-one-tap","google_sign_in_android":true,"reengagement_notification_duration":3,"browsable_stream_config_bucket":"curated-topics","enable_dedicated_series_tab_api_ios":true,"enable_post_import":true,"available_monthly_plan":"60e220181034","available_annual_plan":"2c754bcc2995","disable_ios_resume_reading_toast":true,"is_not_medium_subscriber":true,"glyph_font_set":"m2","enable_branding":true,"enable_branding_fonts":true,"max_premium_content_per_user_under_metering":3,"enable_automated_mission_control_triggers":true,"enable_lite_profile":true,"enable_marketing_emails":true,"enable_topic_lifecycle_email":true,"enable_parsely":true,"enable_branch_io":true,"enable_ios_post_stats":true,"enable_lite_topics":true,"enable_lite_stories":true,"redis_read_write_splitting":true,"enable_tipalti_onboarding":true,"enable_annual_renewal_reminder_email":true,"enable_janky_spam_rules":"users,posts","enable_new_collaborative_filtering_data":true,"android_rating_prompt_stories_read_threshold":2,"enable_smart_meter_with_incentive":true,"stripe_v3":true,"enable_google_one_tap":true,"enable_email_sign_in_captcha":true,"enable_rito_sequence_post_recirc_query":true,"enable_primary_topic_for_mobile":true,"enable_rito_sequence_post_handler":true,"enable_interest_graph_with_signup_post":true,"enable_todays_highlights_android":true,"enable_improved_stats_curation_status":true,"enable_story_onboarding":true,"enable_logged_out_homepage_signup":true,"enable_email_signup_nonmoc":true,"use_new_admin_topic_backend":true,"enable_full_name_screen_refresh":true,"enable_quarantine_rules":true,"enable_lite_privacy_banner":true,"enable_simplified_welcome_email":true,"enable_digest_inbox_education_promo":true,"posts_sharing_tags_without_hopper":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","fp":{"/icons/monogram-mask.svg":"https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico","faviconImageId":"1*8I-HPL0bfoIzGied-dzOvA.png","fontSets":[{"id":8,"url":"https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"},{"id":11,"url":"https://glyph.medium.com/css/m2.css"},{"id":9,"url":"https://glyph.medium.com/css/mkt.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium-editor.3Y6xpZ-0FSdWDnPM3hSBIA.ico","glyphUrl":"https://glyph.medium.com"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":false,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"lightstep":{"accessToken":"ce5be895bef60919541332990ac9fef2","carrier":"{\"ot-tracer-spanid\":\"16c94bec2b315183\",\"ot-tracer-traceid\":\"09f2859900cb9845\",\"ot-tracer-sampled\":\"true\"}","host":"collector-medium.lightstep.com"},"facebook":{"key":"542599432471018","namespace":"medium-com","scope":{"default":["public_profile","email"],"connect":["public_profile","email"],"login":["public_profile","email"],"share":["public_profile","email"]}},"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","audioContentTopicId":"3792abbd134","brandedSequenceId":"7d337ddf1941","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com","buggle":{"url":"https://buggle.medium.com","videoUrl":"https://cdn-videos-1.medium.com","audioUrl":"https://cdn-audio-1.medium.com"},"referrerType":2,"isMeteredOut":false,"meterConfig":{"maxUnlockCount":3,"windowLength":"MONTHLY"},"partnerProgramEmail":"partnerprogram@medium.com","userResearchPrompts":[{"promptId":"lo_post_page_4","type":0,"url":"www.calendly.com"},{"promptId":"lo_home_page","type":1,"url":"www.calendly.com"},{"promptId":"lo_profile_page","type":2,"url":"www.calendly.com"}],"recaptchaKey":"6LdAokEUAAAAAC7seICd4vtC8chDb3jIXDQulyUJ","signinWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"countryCode":"AU","bypassMeter":false,"branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","paypal":{"clientMode":"production","oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com/redeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"}},"collectionConfig":{"mediumOwnedAndOperatedCollectionIds":["544c7006046e // Human Parts","bcc38c8f6edf // Matter","444d13b52878 // OneZero"]}}
// ]]></script><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.mYfzFXJfx9gfVir2rwCc7A.js" async></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"5ebb8759a122","versionId":"3d6f7c668997","creatorId":"9954e80b1b09","creator":{"userId":"9954e80b1b09","name":"David Schweikert","username":"schweikert","createdAt":1468916623857,"imageId":"1*3tFco99l7OeYyMfEl8N4Lg.jpeg","backgroundImageId":"","bio":"Cloud Infrastructure Engineer, Open Source Developer","twitterScreenName":"dschweikert","socialStats":{"userId":"9954e80b1b09","usersFollowedCount":15,"usersFollowedByCount":49,"type":"SocialStats"},"social":{"userId":"lo_cb6313db35f1","targetUserId":"9954e80b1b09","type":"Social"},"facebookAccountId":"10208828255055117","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"isWriterProgramEnrolled":true,"isQuarantined":false,"type":"User"},"homeCollection":{"id":"e52cf94d98af","name":"Google Cloud Platform - Community","slug":"google-cloud","tags":["GOOGLE CLOUD PLATFORM","DEVELOPERS","CLOUD COMPUTING","DEVOPS","MACHINE LEARNING"],"creatorId":"a535baed6389","description":"A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.","shortDescription":"A collection of technical articles published or curated by…","image":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":24581,"activeAt":1554328787410},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":"","isEnrolledInHightower":false,"isEligibleForHightower":false},"logo":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"twitterUsername":"gcpcloud","facebookPageName":"googlecloud","collectionMastheadId":"536cf63fce6","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":10,"postIds":["719c317bf2df","c3483e88a352","84170ea44833","b167d0eb487a","63872b56a58e","4cffa22e3348","be418274d36c","4e7873811e86","42bbb1308e76","76442253a45a"]}},{"type":1,"postListMetadata":{"source":2,"layout":4,"number":7,"postIds":[],"sectionHeader":"Trending"}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":10,"postIds":[],"sectionHeader":"Latest"}}],"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF02B875","point":0},{"color":"#FF00AB6B","point":0.1},{"color":"#FF1C9963","point":0.2},{"color":"#FF092E20","point":1}],"backgroundColor":"#FFFFFFFF"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFFFFF","point":0},{"color":"#FFE9FDF0","point":0.1},{"color":"#FFE2FAEE","point":0.2},{"color":"#FFADFFCF","point":0.6},{"color":"#FF7DFFB3","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":4,"title":"This Week in GCP","url":"https://medium.com/google-cloud/weekly/home","topicId":"af575ce9e5c7","source":"topicId"},{"type":1,"title":"Containers","tagSlug":"kubernetes","url":"https://medium.com/google-cloud/tagged/kubernetes","source":"tagSlug"},{"type":1,"title":"Virtualization","tagSlug":"google-compute-engine","url":"https://medium.com/google-cloud/tagged/google-compute-engine","source":"tagSlug"},{"type":1,"title":"Platform as a Service","tagSlug":"google-app-engine","url":"https://medium.com/google-cloud/tagged/google-app-engine","source":"tagSlug"},{"type":1,"title":"Data","tagSlug":"bigquery","url":"https://medium.com/google-cloud/tagged/bigquery","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/google-cloud/tagged/machine-learning","source":"tagSlug"},{"type":1,"title":"IoT","tagSlug":"iot","url":"https://medium.com/google-cloud/tagged/iot","source":"tagSlug"},{"type":3,"title":"More","url":"https://cloud.google.com/blog/"}],"colorBehavior":1,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5},"type":"Collection"},"homeCollectionId":"e52cf94d98af","title":"Infrastructure as Code with Deployment Manager","detectedLanguage":"en","latestVersion":"3d6f7c668997","latestPublishedVersion":"3d6f7c668997","hasUnpublishedEdits":false,"latestRev":121,"createdAt":1525159887370,"updatedAt":1529392247875,"acceptedAt":0,"firstPublishedAt":1525237431242,"latestPublishedAt":1525894204095,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"Setup a Kubernetes Cluster and Kubernetes Applications in GCP using Deployment Manager","bodyModel":{"paragraphs":[{"name":"8b01","type":3,"text":"GCP Infrastructure as Code with Deployment Manager","markups":[]},{"name":"f2cf","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*c71MGBJTmz_XvqrY1rUbIg.png","originalWidth":1816,"originalHeight":760}},{"name":"d0c7","type":1,"text":"Infrastructure as code is the practice of making the configuration of your infrastructure reproducible, scalable, and easy to review, by describing it using code. Infrastructure as code comes from the realization that infrastructure is also “software”, which is particularly true for the public cloud. Because it is software, it should by also version-controlled, tested, and reviewed. Even better, you can start putting the description of the required infrastructure together with the code of the application, and have thus a complete definition of all that is required in one place. You can start testing and deploying everything together.","markups":[]},{"name":"57a0","type":1,"text":"There are many tools available that help you achieve this, including for example Ansible and Terraform, but they don’t always provide a perfect match to what is available on public cloud hosting platforms such as AWS, Azure, or Google Cloud Platform. That should be no surprise, considering the incredible pace of new features that are being introduced. That’s the reason why some cloud providers also give you their own infrastructure as code tools, as part of their offering. AWS has “Amazon Cloud Formation”, Azure has “Azure Resource Manager”, and for the Google Cloud there is “Deployment Manager”. They all provide a way to define your cloud infrastructure resources using a declarative language, which you can then put in a git repository, for example. Also, you can use templates, which allows you to avoid code duplication, and makes it possible to test the same infrastructure code in various stages of deployment.","markups":[]},{"name":"7a27","type":1,"text":"In this article, we will focus on Google Cloud Platform and how you can use Google Cloud Deployment Manager to automate the configuration of all your GCP resources. As a practical demonstration, we will deploy a Kubernetes cluster and a simple application running on it, all created automatically. It includes the following resources:","markups":[]},{"name":"b220","type":9,"text":"a Kubernetes cluster (Google Kubernetes Engine)","markups":[]},{"name":"a4bd","type":9,"text":"a Kubernetes deployment","markups":[]},{"name":"99f1","type":9,"text":"a Kubernetes service","markups":[]},{"name":"6c02","type":9,"text":"a Kubernetes ingress definition","markups":[]},{"name":"c036","type":13,"text":"Deployment Manager Basics","markups":[]},{"name":"4a59","type":1,"text":"Before we start with the creation of GCP resources using Deployment Manager, let’s start with a very quick summary of how it works.","markups":[]},{"name":"0ba1","type":1,"text":"Deployment Manager has the concept of a deployment, which is a collection of GCP resources that form a logical unit and that are deployed together. The resources of a deployment can be anything available on GCP: VMs, IP addresses, database servers, Kubernetes clusters, etc.","markups":[{"type":2,"start":40,"end":50}]},{"name":"7f7a","type":1,"text":"In order to create a deployment, you need a deployment configuration, which is a YAML file containing the definition of the resources. To give you an idea, it could look as follows:","markups":[{"type":2,"start":44,"end":68}]},{"name":"5cb4","type":8,"text":"resources:\n- name: example-vm\n  type: compute.v1.instance\n  properties:\n    zone: europe-west1-b\n    machineType: zones/europe-west1-b/machineTypes/n1-standard-1\n    disks:\n       ...","markups":[{"type":10,"start":0,"end":183}]},{"name":"f2cb","type":1,"text":"Each listed resource always has a type, which is the kind of resource that will be created (a VM, an IP address, etc.), a name, and properties describing with what parameters the resource should be created.","markups":[{"type":2,"start":34,"end":38},{"type":2,"start":122,"end":126},{"type":2,"start":132,"end":142}]},{"name":"e686","type":1,"text":"An important concept, in comparison to say Ansible, is that when you create a deployment, it exists as a resource itself inside GCP. If you later change the configuration of the deployment (by modifying the YAML file, for example), and run the update command, deployment manager will compare the new configuration to what it deployed before, and will only make the required changes. Not only less work needs to be done, but more importantly, it also ensures that any removed resources from the configuration, will also be removed from the GCP infrastructure.","markups":[]},{"name":"51af","type":1,"text":"You can find many deployment configuration examples at the Google Deployment Manager samples project on GitHub. It is often more useful than the official documentation, to find out exactly what parameters you should define.","markups":[{"type":3,"start":59,"end":92,"href":"https://github.com/GoogleCloudPlatform/deploymentmanager-samples","title":"","rel":"","anchorType":0},{"type":3,"start":145,"end":167,"href":"https://cloud.google.com/deployment-manager/docs/","title":"","rel":"","anchorType":0}]},{"name":"ed89","type":13,"text":"Preparations (if you want to execute the code)","markups":[]},{"name":"a080","type":1,"text":"If you want to learn how deployment manager works, I suggest that you also try to deploy this example application when reading along. You will see, how incredibly quick and easy it is to deploy all of these components. What would take usually days to set up, will only need minutes. If you want to do that, prepare as follows:","markups":[]},{"name":"0076","type":1,"text":"First of all, make sure that you have a GCP account and a GCP project with billing enabled. Also, you will need the Google Cloud SDK installed, which includes the “gcloud” command-line tool that we will use.","markups":[{"type":3,"start":116,"end":132,"href":"https://cloud.google.com/sdk/","title":"","rel":"","anchorType":0}]},{"name":"a7ba","type":8,"text":"$ gcloud auth login\n$ gcloud config set project $MYPROJECT_ID","markups":[{"type":10,"start":0,"end":61}]},{"name":"39ca","type":1,"text":"Next, clone the github repo that I prepared with all the code examples in this article:","markups":[]},{"name":"9580","type":8,"text":"$ git clone https://github.com/schweikert/gcp-infra-as-code\n$ cd gcp-infra-as-code","markups":[{"type":10,"start":0,"end":82}]},{"name":"5061","type":13,"text":"Creating a Kubernetes cluster","markups":[]},{"name":"6719","type":1,"text":"The first thing that we will do, is to create a Kubernetes cluster. You can find in the list of supported resources that the name of the resource in deployment manager is “container.v1.cluster”. A very simple definition looks as follows:","markups":[{"type":3,"start":88,"end":115,"href":"https://cloud.google.com/deployment-manager/docs/configuration/supported-resource-types","title":"","rel":"","anchorType":0}]},{"name":"0f32","type":8,"text":"resources:\n\n- name: cluster\n  type: container.v1.cluster\n  properties:\n    zone: europe-west1-b\n    cluster:\n      description: \"My example cluster\"\n      initialNodeCount: 2","markups":[{"type":10,"start":0,"end":174}]},{"name":"fc0c","type":1,"text":"This would create a Kubernetes cluster in a single zone with 2 nodes.","markups":[]},{"name":"35b5","type":1,"text":"The cluster.yaml file in the github repository specifies a few more parameters, such as distributing the nodes across two zones and enabling “auto-upgrade” for the cluster nodes.","markups":[{"type":3,"start":4,"end":16,"href":"https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-1/cluster.yaml","title":"","rel":"","anchorType":0}]},{"name":"1836","type":1,"text":"You can instantiate this deployment by using the “create” command:","markups":[]},{"name":"2b15","type":8,"text":"$ gcloud deployment-manager deployments create example-cluster --config cluster-1/cluster.yaml","markups":[{"type":10,"start":0,"end":94}]},{"name":"08af","type":1,"text":"This creates a deployment called “example-cluster”, using the definition found in cluster-1/cluster.yaml. You can later then update the yaml file, and update the deployed deployment with the “update” command:","markups":[]},{"name":"fed9","type":8,"text":"$ gcloud deployment-manager deployments update example-cluster --config cluster-1/cluster.yaml","markups":[{"type":10,"start":0,"end":94}]},{"name":"d8a9","type":1,"text":"This command compares the deployed deployment with the new definition and executes only the needed changes (for example creates a new resource that you added).","markups":[]},{"name":"5c0f","type":1,"text":"For now, delete the cluster. We will re-create it again later.","markups":[]},{"name":"c312","type":8,"text":"$ gcloud deployment-manager deployments delete example-cluster","markups":[{"type":10,"start":0,"end":62}]},{"name":"d814","type":13,"text":"Templating","markups":[]},{"name":"2125","type":1,"text":"These yaml files are actually your infrastructure “code”, and you probably want to test that code first, before deploying it. For this to be effective, you should deploy the same code both for testing and for production, even though these environments might need a few parameters to be specified differently.","markups":[]},{"name":"ccd8","type":1,"text":"That’s where templating becomes very useful. You can have a single template used for all your environments, and just parametrize what needs to be different. Deployment Manager supports Python scripts and Jinja 2 as templating language. I will demonstrate templating using Jinja 2 because even though Python is recommended by Google, I find Jinja 2 much more adequate and easy to read for this use case.","markups":[]},{"name":"273a","type":1,"text":"The “cluster-2” directory contains the same example but split into two files.","markups":[]},{"name":"3be0","type":1,"text":"The resource definition:","markups":[{"type":3,"start":4,"end":23,"href":"https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/example-cluster.yaml","title":"","rel":"","anchorType":0}]},{"name":"5b97","type":8,"text":"imports:\n- path: templates/cluster.jinja\n  name: cluster.jinja\n\nresources:\n- name: example-cluster\n  type: cluster.jinja\n  properties:\n    description: \"Example Cluster\"\n    zones:\n    - europe-west3-b  \n    - europe-west3-c\n    initialNodeCount: 1","markups":[{"type":10,"start":0,"end":248}]},{"name":"3a8c","type":1,"text":"This file has a structure very similar to the non-templated version, but instead of instantiating GCP resources directly, it instantiates a template. That template instance also has a name and properties, which can then be used in the template definition.","markups":[]},{"name":"9ef4","type":1,"text":"The template:","markups":[{"type":3,"start":4,"end":12,"href":"https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/templates/cluster.jinja","title":"","rel":"","anchorType":0}]},{"name":"cf38","type":8,"text":"resources:\n\n- name: {{ env['name'] }}\n  type: container.v1.cluster\n  properties:\n    zone: {{ properties['zones'][0] }}\n    ...","markups":[{"type":10,"start":0,"end":127}]},{"name":"55f5","type":1,"text":"With the Jinja 2 syntax, the template instance name and properties are used to parametrize it.","markups":[]},{"name":"25a0","type":1,"text":"The command to create the deployment is the same as before:","markups":[]},{"name":"e277","type":8,"text":"$ gcloud deployment-manager deployments create example-cluster --config cluster-2/example-cluster.yaml","markups":[{"type":10,"start":0,"end":102}]},{"name":"0959","type":13,"text":"Deployment Manager and 3rd-Party Resources","markups":[]},{"name":"d9c3","type":1,"text":"An amazing ability of Deployment Manager is that you can teach it to manage any kind of resource that you want, besides what it already knows about. Provided that the API to manage these resources fulfills some criteria, you can add that API and define third-party resource also as part of your Deployment Manager deployments.","markups":[{"type":3,"start":206,"end":219,"href":"https://cloud.google.com/deployment-manager/docs/configuration/type-providers/process-adding-api","title":"","rel":"","anchorType":0}]},{"name":"8ba3","type":1,"text":"One very interesting use-case for this is the management of Kubernetes resources. Deployment manager doesn’t know out of the box how to create, modify or delete Kubernetes resources of a Kubernetes cluster, but you can add code to make it possible.","markups":[]},{"name":"0bf4","type":1,"text":"Kubernetes resources are managed by interacting with Kubernetes via a well-defined and versioned API. To make it at the same time extensible, but also backward compatible, there are multiple API endpoints which reflect the scope and maturity of the managed resources. For example, “services” are part of the core functionality and are considered mature, as such methods to manage service resources are part of the API endpoint “/api/v1”. Other more recently added resource types are found at other endpoints: “deployments” are considered beta and are managed with the API endpoint “/apis/extensions/v1beta1”.","markups":[]},{"name":"5063","type":1,"text":"For each of these API endpoints, we will need to add instructions for Deployment Manager, so that it knows about how to use it. The needed code for that is usually deployed as part of the cluster deployment so that as soon as you have created the cluster, you can also start managing Kubernetes resources in it.","markups":[]},{"name":"acb7","type":1,"text":"The “cluster-3” example contains an additional part that will make it possible to deploy Kubernetes resources. If you look at the “cluster-3/templates/cluster.jinja” file, you will find this:","markups":[]},{"name":"9311","type":8,"text":"{% set K8S_ENDPOINTS = {\n      '': 'api/v1',\n      '-apps': 'apis/apps/v1',\n      '-rbac': 'apis/rbac.authorization.k8s.io/v1',\n      '-v1beta1-extensions': 'apis/extensions/v1beta1'\n} %}\n\n...\n\n{% for typeSuffix, endpoint in K8S_ENDPOINTS.iteritems() %}\n- name: {{ env['name'] }}-type{{ typeSuffix }}\n  type: deploymentmanager.v2beta.typeProvider\n  properties:\n    ...\n    descriptorUrl: https://$(ref.{{ env['name'] }}.endpoint)/swaggerapi/{{ endpoint }}\n{% endfor %}","markups":[{"type":10,"start":0,"end":468}]},{"name":"4a2d","type":1,"text":"We won’t go into the details, but you can see that it uses a Jinja loop to create definitions for each of the API endpoints that we want to use. It uses a Swagger or OpenAPI URL to discover what methods are available at each endpoint, and how to call them. The first iteration of the loop in the template will produce this:","markups":[]},{"name":"0b2a","type":8,"text":"- name: example-cluster-type\n  type: deploymentmanager.v2beta.typeProvider\n  properties:\n    descriptorUrl: https://$(ref.example-cluster.endpoint)/swaggerapi/api/v1\n    ...","markups":[{"type":10,"start":0,"end":173}]},{"name":"068c","type":1,"text":"The $(ref.example-cluster.endpoint) is an inline-reference and resolves at deploy-time to a property (“endpoint”) of a created resource (“example-cluster”). In this case, it resolves to the IP address of the Kubernetes master service. What it also does, is set a dependency between these two resources (example-cluster-type and example-cluster), and deployment manager will make sure that the resources are created in the right order.","markups":[{"type":10,"start":4,"end":35},{"type":10,"start":303,"end":323},{"type":10,"start":328,"end":343}]},{"name":"1c7d","type":1,"text":"The descriptorUrl becomes something like: https://35.198.131.165/swaggerapi/api/v1, and is used to resolve the api/v1” methods of Kubernetes. The example contains three further API endpoints, and you can extend it as you need (i.e. according to the APIs that you need to access for your deployment).","markups":[{"type":10,"start":4,"end":17},{"type":10,"start":42,"end":82}]},{"name":"212e","type":1,"text":"You can start using these new resource types in the same deployment, or also in new deployments that you create in the same project.","markups":[]},{"name":"dda2","type":1,"text":"After the cluster is deployed, you can see the new types either in the GCP Console (note that there is a section dedicated to the Deployment Manager), or using the gcloud tool:","markups":[]},{"name":"add4","type":8,"text":"$ gcloud deployment-manager types list | grep example\nexample-cluster-type\nexample-cluster-type-apps\nexample-cluster-type-rbac\nexample-cluster-type-v1beta1-extensions","markups":[{"type":10,"start":0,"end":166}]},{"name":"2d28","type":13,"text":"A Kubernetes Application","markups":[]},{"name":"b894","type":1,"text":"Now we are finally ready to create a Kubernetes application using Deployment Manager. We will define three resources: a Kubernetes “deployment” with a pod specification, a service, and an ingress to make the application accessible from outside the cluster.","markups":[]},{"name":"5880","type":1,"text":"As you can see in the template file, each Kubernetes resource is created by referencing one of the above API-based types that we defined as part of the cluster deployment. For example:","markups":[{"type":3,"start":22,"end":35,"href":"https://github.com/schweikert/gcp-infra-as-code/blob/master/hello-world-1/templates/hello-world.jinja","title":"","rel":"","anchorType":0}]},{"name":"e835","type":8,"text":"- name: example-hello-world-svc\n  type: env[‘project’]/example-cluster-type:/api/v1/namespaces/{namespace}/services\n  properties:\n    apiVersion: v1\n    kind: Service","markups":[{"type":10,"start":0,"end":166}]},{"name":"074d","type":1,"text":"Some macros are used to make it a bit easier to write the resources (NAME_PREFIX, CLUSTER_TYPE, etc.).","markups":[]},{"name":"8fed","type":1,"text":"You can deploy the template with the 3 Kubernetes resources as follows:","markups":[]},{"name":"650b","type":8,"text":"$ gcloud deployment-manager deployments update example-hello-world --config hello-world-1/example.yaml","markups":[{"type":10,"start":0,"end":102}]},{"name":"2819","type":1,"text":"GCP will assign automatically an ephemeral static IP address to access your application. You can find out what it is using the kubectl command, but first you need to get the needed credentials for it:","markups":[]},{"name":"44c5","type":8,"text":"$ gcloud container clusters get-credentials example-cluster --zone europe-west1-b\n\n$ kubectl get pod                              \nNAME                                   READY     STATUS    RESTARTS   AGE                                                \nhello-world-example-75d79ccdd5-pmjcg   1/1       Running   0          1m\nhello-world-example-75d79ccdd5-vtb6g   1/1       Running   0          1m","markups":[{"type":10,"start":0,"end":398}]},{"name":"3452","type":1,"text":"Now you can look at the ingress resource to find out the external IP address:","markups":[]},{"name":"7274","type":8,"text":"$ kubectl get ingress -o wide\nNAME                  HOSTS     ADDRESS         PORTS     AGE\nhello-world-example   *         35.201.65.191   80        10m","markups":[{"type":10,"start":0,"end":153}]},{"name":"00f7","type":1,"text":"… and access your application here: http://35.201.65.191.","markups":[{"type":3,"start":36,"end":57,"href":"http://35.201.65.191.","title":"","rel":"","anchorType":0}]},{"name":"fe13","type":1,"text":"Voilà, a fully reproducible Kubernetes cluster and application described as code :)","markups":[]},{"name":"707a","type":1,"text":"To continue experimenting with Deployment Manager, you could have a look at Google KMS, which allows you to encrypt secrets using a key that you store in GCP (so that you can put encrypted values in your configuration files), and generate for example Kubernetes secrets using that. Also something that I already tested and works well, is creating a PostgreSQL database and deploying the Cloud SQL Proxy with a service account that is generated via deployment manager. Let me know if you would be interesting in reading an article about that.","markups":[]},{"name":"cdbc","type":1,"text":"Don’t forget to clean up everything after you have finished experimenting so that you don’t waste GCP credits.","markups":[]}],"sections":[{"name":"6b46","startIndex":0}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"1*c71MGBJTmz_XvqrY1rUbIg.png","filter":"","backgroundSize":"","originalWidth":1816,"originalHeight":760,"strategy":"resample","height":0,"width":0},"wordCount":2177,"imageCount":1,"readingTime":8.415094339622641,"subtitle":"Setup a Kubernetes Cluster and Kubernetes Applications in GCP using Deployment Manager","publishedInCount":1,"usersBySocialRecommends":[],"noIndex":false,"recommends":41,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"google-cloud-platform","name":"Google Cloud Platform","postCount":5180,"metadata":{"postCount":5180,"coverImage":{"id":"1*7eSm8rEwDoBn4Fk2tNecWg.png","originalWidth":1152,"originalHeight":864,"isFeatured":true}},"type":"Tag"},{"slug":"kubernetes","name":"Kubernetes","postCount":7639,"metadata":{"postCount":7639,"coverImage":{"id":"0*jk6kfnDAhLEWy712.png","originalWidth":624,"originalHeight":696,"isFeatured":true}},"type":"Tag"},{"slug":"infrastructure-as-code","name":"Infrastructure As Code","postCount":447,"metadata":{"postCount":447,"coverImage":{"id":"1*3ewRImzpkYHMHL-tzQunvA.png","originalWidth":1077,"originalHeight":671,"isFeatured":true}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":3,"links":{"entries":[{"url":"http://35.201.65.191.","alts":[],"httpStatus":0},{"url":"https://github.com/schweikert/gcp-infra-as-code/blob/master/hello-world-1/templates/hello-world.jinja","alts":[],"httpStatus":200},{"url":"https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-1/cluster.yaml","alts":[],"httpStatus":200},{"url":"https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/example-cluster.yaml","alts":[],"httpStatus":200},{"url":"https://github.com/schweikert/gcp-infra-as-code/blob/master/cluster-2/templates/cluster.jinja","alts":[],"httpStatus":200},{"url":"https://github.com/GoogleCloudPlatform/deploymentmanager-samples","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/deployment-manager/docs/configuration/supported-resource-types","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/deployment-manager/docs/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/sdk/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/deployment-manager/docs/configuration/type-providers/process-adding-api","alts":[],"httpStatus":200}],"version":"0.3","generatedAt":1525894204864},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":169,"sectionCount":1,"readingList":0,"topics":[]},"coverless":true,"slug":"2018-google-deployment-manager","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":false,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"2018-google-deployment-manager-5ebb8759a122","previewContent":{"bodyModel":{"paragraphs":[{"name":"8b01","type":3,"text":"GCP Infrastructure as Code with Deployment Manager","markups":[],"alignment":1},{"name":"f2cf","type":4,"text":"","markups":[],"layout":9,"metadata":{"id":"1*c71MGBJTmz_XvqrY1rUbIg.png","originalWidth":1816,"originalHeight":760}}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"Setup a Kubernetes Cluster and Kubernetes Applications in GCP using Deployment Manager"},"license":3,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122","approvedHomeCollectionId":"e52cf94d98af","approvedHomeCollection":{"id":"e52cf94d98af","name":"Google Cloud Platform - Community","slug":"google-cloud","tags":["GOOGLE CLOUD PLATFORM","DEVELOPERS","CLOUD COMPUTING","DEVOPS","MACHINE LEARNING"],"creatorId":"a535baed6389","description":"A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.","shortDescription":"A collection of technical articles published or curated by…","image":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":24581,"activeAt":1554328787410},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":"","isEnrolledInHightower":false,"isEligibleForHightower":false},"logo":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"twitterUsername":"gcpcloud","facebookPageName":"googlecloud","collectionMastheadId":"536cf63fce6","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":10,"postIds":["719c317bf2df","c3483e88a352","84170ea44833","b167d0eb487a","63872b56a58e","4cffa22e3348","be418274d36c","4e7873811e86","42bbb1308e76","76442253a45a"]}},{"type":1,"postListMetadata":{"source":2,"layout":4,"number":7,"postIds":[],"sectionHeader":"Trending"}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":10,"postIds":[],"sectionHeader":"Latest"}}],"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF02B875","point":0},{"color":"#FF00AB6B","point":0.1},{"color":"#FF1C9963","point":0.2},{"color":"#FF092E20","point":1}],"backgroundColor":"#FFFFFFFF"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFFFFF","point":0},{"color":"#FFE9FDF0","point":0.1},{"color":"#FFE2FAEE","point":0.2},{"color":"#FFADFFCF","point":0.6},{"color":"#FF7DFFB3","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":4,"title":"This Week in GCP","url":"https://medium.com/google-cloud/weekly/home","topicId":"af575ce9e5c7","source":"topicId"},{"type":1,"title":"Containers","tagSlug":"kubernetes","url":"https://medium.com/google-cloud/tagged/kubernetes","source":"tagSlug"},{"type":1,"title":"Virtualization","tagSlug":"google-compute-engine","url":"https://medium.com/google-cloud/tagged/google-compute-engine","source":"tagSlug"},{"type":1,"title":"Platform as a Service","tagSlug":"google-app-engine","url":"https://medium.com/google-cloud/tagged/google-app-engine","source":"tagSlug"},{"type":1,"title":"Data","tagSlug":"bigquery","url":"https://medium.com/google-cloud/tagged/bigquery","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/google-cloud/tagged/machine-learning","source":"tagSlug"},{"type":1,"title":"IoT","tagSlug":"iot","url":"https://medium.com/google-cloud/tagged/iot","source":"tagSlug"},{"type":3,"title":"More","url":"https://cloud.google.com/blog/"}],"colorBehavior":1,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5},"type":"Collection"},"newsletterId":"","webCanonicalUrl":"https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122","mediumUrl":"https://medium.com/google-cloud/2018-google-deployment-manager-5ebb8759a122","migrationId":"","notifyFollowers":true,"notifyTwitter":true,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isNsfw":false,"isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"9954e80b1b09":{"userId":"9954e80b1b09","name":"David Schweikert","username":"schweikert","createdAt":1468916623857,"imageId":"1*3tFco99l7OeYyMfEl8N4Lg.jpeg","backgroundImageId":"","bio":"Cloud Infrastructure Engineer, Open Source Developer","twitterScreenName":"dschweikert","socialStats":{"userId":"9954e80b1b09","usersFollowedCount":15,"usersFollowedByCount":49,"type":"SocialStats"},"social":{"userId":"lo_cb6313db35f1","targetUserId":"9954e80b1b09","type":"Social"},"facebookAccountId":"10208828255055117","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"isWriterProgramEnrolled":true,"isQuarantined":false,"type":"User"}},"Collection":{"e52cf94d98af":{"id":"e52cf94d98af","name":"Google Cloud Platform - Community","slug":"google-cloud","tags":["GOOGLE CLOUD PLATFORM","DEVELOPERS","CLOUD COMPUTING","DEVOPS","MACHINE LEARNING"],"creatorId":"a535baed6389","description":"A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.","shortDescription":"A collection of technical articles published or curated by…","image":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":24581,"activeAt":1554328787410},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":"","isEnrolledInHightower":false,"isEligibleForHightower":false},"logo":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"twitterUsername":"gcpcloud","facebookPageName":"googlecloud","collectionMastheadId":"536cf63fce6","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":10,"postIds":["719c317bf2df","c3483e88a352","84170ea44833","b167d0eb487a","63872b56a58e","4cffa22e3348","be418274d36c","4e7873811e86","42bbb1308e76","76442253a45a"]}},{"type":1,"postListMetadata":{"source":2,"layout":4,"number":7,"postIds":[],"sectionHeader":"Trending"}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":10,"postIds":[],"sectionHeader":"Latest"}}],"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF02B875","point":0},{"color":"#FF00AB6B","point":0.1},{"color":"#FF1C9963","point":0.2},{"color":"#FF092E20","point":1}],"backgroundColor":"#FFFFFFFF"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFFFFF","point":0},{"color":"#FFE9FDF0","point":0.1},{"color":"#FFE2FAEE","point":0.2},{"color":"#FFADFFCF","point":0.6},{"color":"#FF7DFFB3","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":4,"title":"This Week in GCP","url":"https://medium.com/google-cloud/weekly/home","topicId":"af575ce9e5c7","source":"topicId"},{"type":1,"title":"Containers","tagSlug":"kubernetes","url":"https://medium.com/google-cloud/tagged/kubernetes","source":"tagSlug"},{"type":1,"title":"Virtualization","tagSlug":"google-compute-engine","url":"https://medium.com/google-cloud/tagged/google-compute-engine","source":"tagSlug"},{"type":1,"title":"Platform as a Service","tagSlug":"google-app-engine","url":"https://medium.com/google-cloud/tagged/google-app-engine","source":"tagSlug"},{"type":1,"title":"Data","tagSlug":"bigquery","url":"https://medium.com/google-cloud/tagged/bigquery","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/google-cloud/tagged/machine-learning","source":"tagSlug"},{"type":1,"title":"IoT","tagSlug":"iot","url":"https://medium.com/google-cloud/tagged/iot","source":"tagSlug"},{"type":3,"title":"More","url":"https://cloud.google.com/blog/"}],"colorBehavior":1,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5},"type":"Collection"}},"Social":{"9954e80b1b09":{"userId":"lo_cb6313db35f1","targetUserId":"9954e80b1b09","type":"Social"}},"SocialStats":{"9954e80b1b09":{"userId":"9954e80b1b09","usersFollowedCount":15,"usersFollowedByCount":49,"type":"SocialStats"}}}})
// ]]></script><script id="parsely-cfg" src="//d1z2jf7jlzjs58.cloudfront.net/keys/medium.com/p.js"></script><script type="text/javascript">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0); branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true, 'tracking_disabled':  false }, function(err, data) {});</script></body></html>